services:
  app:
    build: 
      context: ..
      dockerfile: .devcontainer/Dockerfile
    volumes:
      - ..:/workspace:cached
      - claude-history:/home/vscode/commandhistory
      - claude-config:/home/vscode/.config/claude
    cap_add:
      - NET_ADMIN
      - NET_RAW
    # This makes 'app' use Neo4j's network. 
    # 'localhost' in App == 'localhost' in Neo4j.
    network_mode: service:neo4j 
    command: sleep infinity

  neo4j:
    image: neo4j:5.15
    restart: unless-stopped
    ports:
# üîí SECURE BINDING: Only your laptop can access these.
      # Neo4j HTTP
      - "127.0.0.1:7474:7474"
      # Neo4j Bolt
      - "127.0.0.1:7687:7687"
      # Jupyter (Running in App, mapped here due to shared network)
      - "127.0.0.1:8888:8888"
    environment:
      - NEO4J_AUTH=neo4j/password
      - NEO4J_PLUGINS=["apoc", "graph-data-science"]
      - NEO4J_dbms_security_procedures_unrestricted=apoc.*,gds.*
      # ‚ö†Ô∏è CRITICAL FOR NEO4J 5.x ‚ö†Ô∏è
      # Old version was 'dbms', new is 'server'. 
      # 0.0.0.0 allows connections from Windows/WSL.
      - NEO4J_server_default__listen__address=0.0.0.0

volumes:
  claude-history:
  claude-config: